<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Университетский чат-бот на MAX</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; text-align: center; }
    #app { max-width: 400px; margin: 0 auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; }
    .btn { display: block; width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
    .btn:hover { opacity: 0.9; }
    #btn-about     { background: #0073e6; color: #fff; }
    #btn-faculties { background: #28a745; color: #fff; }
    #btn-admission { background: #ffc107; color: #333; }
    #btn-contacts  { background: #dc3545; color: #fff; }
    #response { min-height: 80px; margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: #fafafa; text-align: left; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div id="app">
    <h2>Университетский чат-бот</h2>
    <button id="btn-about"     class="btn">Об университете</button>
    <button id="btn-faculties" class="btn">Факультеты</button>
    <button id="btn-admission" class="btn">Поступление</button>
    <button id="btn-contacts"  class="btn">Контакты</button>
    <div id="response">Здесь будет ответ бота...</div>
  </div>

  <script>
    const TOKEN   = 'f9LHodD0cOJ6YJ1wBe6O6ct1OdPM2jN9ao94exmMt8mgF0DdcVd7bVrC9kbp_lcaZDHahkqpMy6A72phAlvk';
    const params  = new URLSearchParams(window.location.search);
    const CHAT_ID = params.get('chat_id') || 'DEFAULT_CHAT_ID';

    document.addEventListener('DOMContentLoaded', () => {
      const respEl = document.getElementById('response');

      if (typeof MAX === 'undefined' || !MAX.api || typeof MAX.api.sendMessage !== 'function') {
        respEl.textContent = 'Ошибка: MAX API недоступно. Убедитесь, что вы открыли приложение внутри MAX-мессенджера.';
        return;
      }

      function sendToBot(text) {
        respEl.textContent = 'Отправка запроса...';
        // Если SDK возвращает Promise
        const result = MAX.api.sendMessage({ token: TOKEN, chat_id: CHAT_ID, text: text });
        if (result && typeof result.then === 'function') {
          result
            .then(response => {
              const reply = response.reply || response.data?.reply || 'Бот ничего не прислал.';
              respEl.textContent = reply;
            })
            .catch(err => {
              respEl.textContent = 'Ошибка соединения: ' + (err.message || JSON.stringify(err));
            });
        } else {
          // Если SDK использует callback (err, res)
          MAX.api.sendMessage(
            { token: TOKEN, chat_id: CHAT_ID, text: text },
            function(err, response) {
              if (err) {
                respEl.textContent = 'Ошибка соединения: ' + (err.message || JSON.stringify(err));
              } else {
                const reply = response.reply || response.data?.reply || 'Бот ничего не прислал.';
                respEl.textContent = reply;
              }
            }
          );
        }
      }

      document.getElementById('btn-about').addEventListener('click',     () => sendToBot('Расскажите об университете'));
      document.getElementById('btn-faculties').addEventListener('click', () => sendToBot('Какие есть факультеты'));
      document.getElementById('btn-admission').addEventListener('click', () => sendToBot('Условия поступления'));
      document.getElementById('btn-contacts').addEventListener('click',  () => sendToBot('Контактная информация университета'));
    });
  </script>
</body>
</html>